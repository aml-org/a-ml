(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{103:function(a,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var e=n(3),o=n(7),i=(n(110),n(111)),r={id:"custom_validations",title:"Custom validations",hide_title:!0},s={unversionedId:"not-published/aml-tutorials/custom_validations",id:"not-published/aml-tutorials/custom_validations",isDocsHomePage:!1,title:"Custom validations",description:"Custom validations",source:"@site/../docs/not-published/aml-tutorials/custom_validations.mdx",slug:"/not-published/aml-tutorials/custom_validations",permalink:"/docs/not-published/aml-tutorials/custom_validations",version:"current",lastUpdatedBy:"arielmirra",lastUpdatedAt:1613661878},l=[{value:"Before you begin",id:"before-you-begin",children:[]},{value:"Download the example",id:"download-the-example",children:[]},{value:"Build and install the AMF command-line tool",id:"build-and-install-the-amf-command-line-tool",children:[]},{value:"Standard validation",id:"standard-validation",children:[]},{value:"Validation profiles",id:"validation-profiles",children:[]}],c={toc:l};function p(a){var t=a.components,n=Object(o.a)(a,["components"]);return Object(i.b)("wrapper",Object(e.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"custom-validations"},"Custom validations"),Object(i.b)("p",null,"This tutorial shows you how to extend the validations capabilities of AML-defined metadata by writing custom validations that can be enforced by AMF."),Object(i.b)("h2",{id:"before-you-begin"},"Before you begin"),Object(i.b)("p",null,"Prerequisites:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"JVM: version 7 or higher"),Object(i.b)("li",{parentName:"ul"},"SBT to build the AMF command-line")),Object(i.b)("h2",{id:"download-the-example"},"Download the example"),Object(i.b)("p",null,"You can download the example from the AML project ",Object(i.b)("a",Object(e.a)({parentName:"p"},{href:"https://github.com/aml-org/examples"}),"examples repository")," in Github."),Object(i.b)("pre",null,Object(i.b)("code",Object(e.a)({parentName:"pre"},{className:"language-bash"}),"\ngit clone https://github.com/aml-org/examples.git\ncd examples\n\n")),Object(i.b)("h2",{id:"build-and-install-the-amf-command-line-tool"},"Build and install the AMF command-line tool"),Object(i.b)("p",null,"This tutorial assumes you have a working version of the AMF command-line as described in the ",Object(i.b)("a",Object(e.a)({parentName:"p"},{href:"/docs/not-published/aml-tutorials/quickstart"}),"quickstart")," tutorial."),Object(i.b)("h2",{id:"standard-validation"},"Standard validation"),Object(i.b)("p",null,"AML dialects encode a mapping from the AST of a YAML/JSON document to a metadata graph and a set of constraints over the shape of that graph. These constraints are formally defined in the AML specification using a W3C recommendation known as ",Object(i.b)("a",Object(e.a)({parentName:"p"},{href:"https://www.w3.org/TR/shacl/"}),"SHACL"),"."),Object(i.b)("p",null,"AMF or any other SHACL compliant processor can validate the graph of data parsed from an AML document using the set of SHACL constraints parsed from the associated AML dialect."),Object(i.b)("p",null,"The AML dialect ",Object(i.b)("inlineCode",{parentName:"p"},"Playlist 1.0")," located at ",Object(i.b)("inlineCode",{parentName:"p"},"aml/examples/music/dialect/playlist.yaml")," defines a metadata document to encode musical playlists:"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"playlist.yaml")),Object(i.b)("pre",null,Object(i.b)("code",Object(e.a)({parentName:"pre"},{className:"language-yaml"}),"\n#%Dialect 1.0\n\ndialect: Playlist\nversion: 1.0\n\nuses:\n  music: ../vocabulary/music.yaml\n  curation: ../vocabulary/music_curation.yaml\n\nexternal:\n  schema-org: http://schema.org/\n\ndocuments:\n  root:\n    encodes: PlaylistNode\n    declares:\n      composers: ComposerNode\n      records: RecordNode\n\nnodeMappings:\n\n  PlaylistNode:\n    classTerm: curation.Playlist\n    idTemplate: https://api.spotify.com/v1/{author}/playlists/{spotifyId}\n    mapping:\n      spotifyId:\n        propertyTerm: curation.spotifyId\n        range: string\n        mandatory: true\n      author:\n        propertyTerm: curation.author\n        range: string\n        mandatory: true\n      title:\n        propertyTerm: schema-org.name\n        range: string\n        mandatory: true\n      description:\n        propertyTerm: schema-org.description\n        range: string\n      date:\n        propertyTerm: schema-org.dateCreated\n        range: date\n      items:\n        propertyTerm: curation.contents\n        range: SelectionNode\n        mapKey: curation.position\n\n  SelectionNode:\n    classTerm: curation.PlaylistSelection\n    mapping:\n      track:\n        propertyTerm: curation.selectedTrack\n        range: TrackNode\n        mandatory: true\n      artist:\n        propertyTerm: music.performer\n        range: ArtistNode\n        mandatory: true\n      composer:\n        propertyTerm: music.composer\n        range: ComposerNode\n        mandatory: false\n      album:\n        propertyTerm: curation.trackFrom\n        range: RecordNode\n        mandatory: true\n      score:\n        propertyTerm: curation.score\n        range: integer\n\n  TrackNode:\n    classTerm: music.Track\n    idTemplate: https://api.spotify.com/v1/tracks/{spotifyId}\n    mapping:\n      spotifyId:\n        propertyTerm: curation.spotifyId\n        range: string\n        mandatory: true\n      title:\n        propertyTerm: schema-org.name\n        range: string\n        mandatory: true\n      duration:\n        propertyTerm: music.duration\n        range: integer\n\n  ArtistNode:\n    classTerm: music.MusicArtist\n    idTemplate: https://api.spotify.com/v1/artists/{spotifyId}\n    mapping:\n      spotifyId:\n        propertyTerm: curation.spotifyId\n        range: string\n        mandatory: true\n      name:\n        propertyTerm: schema-org.name\n        range: string\n\n  ComposerNode:\n    classTerm: music.MusicArtist\n    idTemplate: https://api.spotify.com/v1/artists/{spotifyId}\n    mapping:\n      spotifyId:\n        propertyTerm: curation.spotifyId\n        range: string\n        mandatory: true\n      name:\n        propertyTerm: schema-org.name\n        range: string\n\n  RecordNode:\n    classTerm: music.Record\n    idTemplate: https://api.spotify.com/v1/albums/{spotifyId}\n    mapping:\n      spotifyId:\n        propertyTerm: curation.spotifyId\n        range: string\n        mandatory: true\n      title:\n        propertyTerm: schema-org.name\n        range: string\n        mandatory: true\n      genre:\n        propertyTerm: music.genre\n        range: string\n        allowMultiple: true\n\n")),Object(i.b)("p",null,"The dialect provides the semantics of the metadata using two AML vocabularies for music and music curation, located at ",Object(i.b)("inlineCode",{parentName:"p"},"aml/music/vocabulary/music.yaml")," and ",Object(i.b)("inlineCode",{parentName:"p"},"aml/music/vocabulary/music_curation.yaml"),"."),Object(i.b)("p",null,"Using this dialect, we can describe document instances encoding playlist information like the one located in ",Object(i.b)("inlineCode",{parentName:"p"},"aml/music/playlist1.yaml"),"."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"playlist1.yaml")),Object(i.b)("pre",null,Object(i.b)("code",Object(e.a)({parentName:"pre"},{className:"language-yaml"}),'\n#%Playlist 1.0\n\ntitle: Favs\ndescription: Some classical compositions\nauthor: antoniogarrote\nspotifyId: 5Qzm0PDPxbNrLvIu0OVinc\n\ndate: 2017-11-10\n\ncomposers:\n  Mozart:\n    spotifyId: 4NJhFmfw43RLBLjQvxDuRS\n    name: Wolfgang Amadeus Mozart\n  Monteverdi:\n    spotifyId: 5iAhVgz6P8Nylxijb0C65v\n    name: Claudio Monteverdi\n\nitems:\n  1:\n    track:\n      spotifyId: 1fdylFrFz7xU6GFEKroIzk\n      title: Sederunt Principes\n      duration: 705\n    artist:\n      spotifyId: 0L8W3JzyTX29RLKZgc3bqS\n      name: The Hiliard Ensemble\n    composer:\n      spotifyId: 2xeXoF8arRZILlw5MKR2f2\n      name: P\xe9rotin\n    album:\n      spotifyId: 2wTfPn8Xt2QdoAcq2VLeay\n      title: P\xe9rotin and the Ars Antiqua\n      genre:\n        - classical\n  2:\n    track:\n      spotifyId: 1mEXZtRMEnjqdPTmZfNzU2\n      title: |\n        String Quintet in C Major G 324, Op 30, No 6\n        "La Musica notturna delle strade di Madrid"\n      duration: 134\n    artist:\n      spotifyId: 1FUwvrAST5IPF5fxqMz7vS\n      name: Cuarteto Casals\n    composer:\n      spotifyId: 2l4vGfFV7e46yO8lxfxR76\n      name: Luigi Boccherini\n    album:\n      spotifyId: 4zs23dPn7XEJcxu375o6xp\n      title: La Musica Notturna delle Strade di Madrid\n    score: 5\n  3:\n    track:\n      spotifyId: 1nqyxZH4AX0o2S9th6kRZL\n      title: Tapiola, Op 112\n      duration: 1088\n    artist:\n      spotifyId: spotify:artist:0AONkUEodQkpkdO5Wul6hE\n      name: Okko Kamu\n    composer:\n      spotifyId: 7jzR5qj8vFnSu5JHaXgFEr\n      name: Jean Sibelius\n    album:\n      spotifyId: 1wXP5c5E2YLHqPCAkxjyTD\n      title: Sibelius, The Tempest, The Bard, Tapiola\n  4:\n    track:\n      spotifyId: 0OLYyVMzILepGc7FKVaLWf\n      title: "Sinfonia Concertante in E flat K364/320d: III Presto"\n    artist:\n      spotifyId: 6pzfUmBsQAKxOhy0NSi8zn\n      name: Anne-Sophie Mutter\n    composer: Mozart\n    album:\n      spotifyId: 2etuXogtzIC3rFVC5XOrhS\n      title: Mozart\n  5:\n    track:\n      spotifyId: 3MpnuPOrFwNB1iCGr4JkVn\n      title: "Duo belli occhi fur l\'armi, onde traffitta"\n      duration: 247\n    artist:\n      spotifyId: 3f26hJvBDQnllvH0aP4OSb\n      name: Concerto Italiano\n    composer: Monteverdi\n    album:\n      spotifyId: 5vkcLFWodr1G7ka2GS1YBg\n      title: Madrigali Amorosi\n  6:\n    track:\n      spotifyId: 3kaz90sTbwAzWM5nzRLXkJ\n      title: Zefiro torna e di soavi accenti, SV 251\n      duration: 367\n    artist:\n      spotifyId: 0vo2ovp2PVDLDsTExmkFpo\n      name: Lautten Compagney\n    composer:\n      $ref: "#/composers/Monteverdi"\n    album:\n      spotifyId: 02G4mzoARL6iMAfn794ppX\n      title: La Dolce Vita\n  7:\n    track:\n      spotifyId: 1QKykbp9b0iNzXCJH6SNWj\n      title: Jazz Suite No 2.2 Lyriz Waltz\n      duration: 157\n    artist:\n      spotifyId: 4Kjr1MPMUfuH3QKXtAljNy\n      name: Riccardo Chailly\n    composer:\n      spotifyId: 6s1pCNXcbdtQJlsnM1hRIA\n      name: Dimitri Shostakovich\n    album:\n      spotifyId: 2EqstXogPyAqKnQV2Imr04\n      title: Shostakovich The Jazz Album\n\n')),Object(i.b)("p",null,"AMF can be used to validate any AML document instance using the ",Object(i.b)("inlineCode",{parentName:"p"},"validate")," command:"),Object(i.b)("pre",null,Object(i.b)("code",Object(e.a)({parentName:"pre"},{className:"language-bash"}),'\nexamples [master] $ java -jar amf.jar validate -ds file://aml/music/dialect/playlist.yaml -in "AML 1.0" -mime-in application/yaml file://aml/music/playlist1.yaml\n{\n  "@type": "http://www.w3.org/ns/shacl#ValidationReport",\n  "http://www.w3.org/ns/shacl#conforms": true\n}\n\n')),Object(i.b)("h2",{id:"validation-profiles"},"Validation profiles"),Object(i.b)("p",null,"Additional validation constraints can be defined over the parsed graph of metadata using a validation profile."),Object(i.b)("p",null,"Validation profiles are documents defined after describing an AML dialect for ",Object(i.b)("a",Object(e.a)({parentName:"p"},{href:"https://github.com/aml-org/amf/blob/master/vocabularies/dialects/validation.raml"}),"validation profiles"),"."),Object(i.b)("p",null,"Validation profile documents can be used to define constraints declaratively and set the severity level of these validations.\nAdditionally, programmatic constraints in JavaScript can also be defined."),Object(i.b)("p",null,"An example of a validation profile can be found at ",Object(i.b)("inlineCode",{parentName:"p"},"aml/music/custom_validations/boring.yaml"),". This profile adds validation errors for every single song with a duration longer than 180 seconds:"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"boring.yaml")),Object(i.b)("pre",null,Object(i.b)("code",Object(e.a)({parentName:"pre"},{className:"language-bash"}),"\n#%Validation Profile 1.0\n\nprofile: Boring Playlists\n\ndescription: Detect boring songs\n\nprefixes:\n  music: http://mulesoft.com/vocabularies/music#\n\nviolation:\n  - too-long1\n\nvalidations:\n\n  too-long1:\n    message: Songs that are too long are boring\n    targetClass: music.Track\n    propertyConstraints:\n      music.duration:\n        maxInclusive: 180\n\n  too-long2:\n    message: Songs that are too long are boring\n    targetClass: music.Track\n    functionConstraint:\n      code: |\n        function(track) {\n          var duration = (track['http://mulesoft.com/vocabularies/music#duration'] || [])\n          return (duration[0] < 180)\n        }\n\n")),Object(i.b)("p",null,"As an example, the constraint has been declared in two different ways. ",Object(i.b)("inlineCode",{parentName:"p"},"too-long1")," defines the constraint declaratively, using the syntax defined in the ",Object(i.b)("inlineCode",{parentName:"p"},"Validation Profile")," dialect.\nThe validation ",Object(i.b)("inlineCode",{parentName:"p"},"too-long2")," is the equivalent validation, but using custom JavaScript code to check the constraint.\nBoth constraints target nodes in the parsed graph, using the semantics defined in the ",Object(i.b)("inlineCode",{parentName:"p"},"Music")," AML vocabulary: the class ",Object(i.b)("inlineCode",{parentName:"p"},"music.Track")," and the property ",Object(i.b)("inlineCode",{parentName:"p"},"music.duration"),"."),Object(i.b)("p",null,"This validation profile can be used in the AMF command line tool using the ",Object(i.b)("inlineCode",{parentName:"p"},"--custom-validation-profile")," argument:"),Object(i.b)("pre",null,Object(i.b)("code",Object(e.a)({parentName:"pre"},{className:"language-bash"}),'\nexamples [master] $ java -jar amf.jar validate -ds file://aml/music/dialect/playlist.yaml --custom-validation-profile file://aml/music/custom_validations/boring.yaml -in "AML 1.0" -mime-in application/yaml file://aml/music/playlist1.yaml\n{\n  "@type": "http://www.w3.org/ns/shacl#ValidationReport",\n  "http://www.w3.org/ns/shacl#conforms": false,\n  "http://www.w3.org/ns/shacl#result": [\n    {\n      "@type": "http://www.w3.org/ns/shacl#ValidationResult",\n      "http://www.w3.org/ns/shacl#resultSeverity": {\n        "@id": "http://www.w3.org/ns/shacl#Violation"\n      },\n      "http://www.w3.org/ns/shacl#focusNode": {\n        "@id": "https://api.spotify.com/v1/tracks/1fdylFrFz7xU6GFEKroIzk"\n      },\n      "http://www.w3.org/ns/shacl#resultPath": {\n        "@id": "http://mulesoft.com/vocabularies/music#duration"\n      },\n      "http://www.w3.org/ns/shacl#resultMessage": "Songs that are too long are boring",\n      "http://www.w3.org/ns/shacl#sourceShape": {\n        "@id": "http://a.ml/vocabularies/data#too-long1"\n      },\n      "http://a.ml/vocabularies/amf/parser#lexicalPosition": {\n        "@type": "http://a.ml/vocabularies/amf/parser#Position",\n        "http://a.ml/vocabularies/amf/parser#start": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 21,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        },\n        "http://a.ml/vocabularies/amf/parser#end": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 24,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        }\n      }\n    },\n    {\n      "@type": "http://www.w3.org/ns/shacl#ValidationResult",\n      "http://www.w3.org/ns/shacl#resultSeverity": {\n        "@id": "http://www.w3.org/ns/shacl#Violation"\n      },\n      "http://www.w3.org/ns/shacl#focusNode": {\n        "@id": "https://api.spotify.com/v1/tracks/1nqyxZH4AX0o2S9th6kRZL"\n      },\n      "http://www.w3.org/ns/shacl#resultPath": {\n        "@id": "http://mulesoft.com/vocabularies/music#duration"\n      },\n      "http://www.w3.org/ns/shacl#resultMessage": "Songs that are too long are boring",\n      "http://www.w3.org/ns/shacl#sourceShape": {\n        "@id": "http://a.ml/vocabularies/data#too-long1"\n      },\n      "http://a.ml/vocabularies/amf/parser#lexicalPosition": {\n        "@type": "http://a.ml/vocabularies/amf/parser#Position",\n        "http://a.ml/vocabularies/amf/parser#start": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 54,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        },\n        "http://a.ml/vocabularies/amf/parser#end": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 57,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        }\n      }\n    },\n    {\n      "@type": "http://www.w3.org/ns/shacl#ValidationResult",\n      "http://www.w3.org/ns/shacl#resultSeverity": {\n        "@id": "http://www.w3.org/ns/shacl#Violation"\n      },\n      "http://www.w3.org/ns/shacl#focusNode": {\n        "@id": "https://api.spotify.com/v1/tracks/3MpnuPOrFwNB1iCGr4JkVn"\n      },\n      "http://www.w3.org/ns/shacl#resultPath": {\n        "@id": "http://mulesoft.com/vocabularies/music#duration"\n      },\n      "http://www.w3.org/ns/shacl#resultMessage": "Songs that are too long are boring",\n      "http://www.w3.org/ns/shacl#sourceShape": {\n        "@id": "http://a.ml/vocabularies/data#too-long1"\n      },\n      "http://a.ml/vocabularies/amf/parser#lexicalPosition": {\n        "@type": "http://a.ml/vocabularies/amf/parser#Position",\n        "http://a.ml/vocabularies/amf/parser#start": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 79,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        },\n        "http://a.ml/vocabularies/amf/parser#end": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 82,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        }\n      }\n    },\n    {\n      "@type": "http://www.w3.org/ns/shacl#ValidationResult",\n      "http://www.w3.org/ns/shacl#resultSeverity": {\n        "@id": "http://www.w3.org/ns/shacl#Violation"\n      },\n      "http://www.w3.org/ns/shacl#focusNode": {\n        "@id": "https://api.spotify.com/v1/tracks/3kaz90sTbwAzWM5nzRLXkJ"\n      },\n      "http://www.w3.org/ns/shacl#resultPath": {\n        "@id": "http://mulesoft.com/vocabularies/music#duration"\n      },\n      "http://www.w3.org/ns/shacl#resultMessage": "Songs that are too long are boring",\n      "http://www.w3.org/ns/shacl#sourceShape": {\n        "@id": "http://a.ml/vocabularies/data#too-long1"\n      },\n      "http://a.ml/vocabularies/amf/parser#lexicalPosition": {\n        "@type": "http://a.ml/vocabularies/amf/parser#Position",\n        "http://a.ml/vocabularies/amf/parser#start": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 91,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        },\n        "http://a.ml/vocabularies/amf/parser#end": {\n          "@type": "http://a.ml/vocabularies/amf/parser#Location",\n          "http://a.ml/vocabularies/amf/parser#line": 94,\n          "http://a.ml/vocabularies/amf/parser#column": 0\n        }\n      }\n    }\n  ]\n}\n\n')))}p.isMDXComponent=!0}}]);