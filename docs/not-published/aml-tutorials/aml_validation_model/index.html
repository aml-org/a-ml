<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="search" type="application/opensearchdescription+xml" title="AML" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">AML validation model | AML</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="AML validation model | AML"><meta data-react-helmet="true" name="description" content="AML validation model"><meta data-react-helmet="true" property="og:description" content="AML validation model"><meta data-react-helmet="true" property="og:url" content="https://aml-org.github.io/docs/not-published/aml-tutorials/aml_validation_model"><link data-react-helmet="true" rel="shortcut icon" href="/img/logos/amlLogo.svg"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://aml-org.github.io/docs/not-published/aml-tutorials/aml_validation_model"><link rel="stylesheet" href="/styles.fb97db39.css">
<link rel="stylesheet" href="/main.bb044ee0.css">
<link rel="preload" href="/styles.3e225d29.js" as="script">
<link rel="preload" href="/runtime~main.ec3c9e33.js" as="script">
<link rel="preload" href="/main.fc69e7f1.js" as="script">
<link rel="preload" href="/1.bb102a6f.js" as="script">
<link rel="preload" href="/2.461c41ab.js" as="script">
<link rel="preload" href="/1be78505.51367d36.js" as="script">
<link rel="preload" href="/935f2afb.17b72296.js" as="script">
<link rel="preload" href="/39.10c467ad.js" as="script">
<link rel="preload" href="/d4d33273.f5fec0e6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logos/amlLogo.svg" alt="AML logo icon" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logos/amlLogo.svg" alt="AML logo icon" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/docs/AML/aml">AML</a><a class="navbar__item navbar__link" href="/docs/AMF/amf_intro">AMF</a></div><div class="navbar__items navbar__items--right"><a href="https://www.npmjs.com/package/amf-client-js" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-npm-link" aria-label="npm link"></a><a href="https://github.com/aml-org/amf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logos/amlLogo.svg" alt="AML logo icon" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logos/amlLogo.svg" alt="AML logo icon" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/AML/aml">AML</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/AMF/amf_intro">AMF</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/amf-client-js" target="_blank" rel="noopener noreferrer" class="menu__link header-npm-link" aria-label="npm link"></a></li><li class="menu__list-item"><a href="https://github.com/aml-org/amf" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aml-validation-model"></a>AML validation model<a class="hash-link" href="#aml-validation-model" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="validation-approach"></a>Validation approach<a class="hash-link" href="#validation-approach" title="Direct link to heading">#</a></h2><p>AMF includes a powerful validation framework that can be used to define constraints and validate them over parsed models for HTTP APIs or any other type of RAML document.</p><p>AMF validation has the following design goals:</p><ul><li>Validation is explicit</li></ul><p>Constraints over the parsed model are explicit. We want to avoid ambiguity about what is valid and invalid for a particular model. All the constraints defined have explicit identifiers and clients can access the full list of validations and their definitions.</p><ul><li>The validation mechanism is formal</li></ul><p>AMF uses a W3C recommendation <a href="https://www.w3.org/TR/shacl/" target="_blank" rel="noopener noreferrer">SHACL</a>, to implement validation. SHACL provide powerful and clearly defined closed world semantics to validate information models, beyond what can be achieved through more limited validation schema languages like JSON-Schema. Thanks to SHACL sound logical foundation, we can explain easily why a model is invalid.</p><ul><li>Validations can be customised</li></ul><p>AMF introduces the notion of a validation profile. Profiles group validations into sets of related constraints following certain semantics or standard requirements. RAML 1.0,RAML 0.8, OAS 2.0 are valid profiles that will ensure compatibility between the parsed model and these specifications. Furthermore, clients can create a custom validation profile, selecting the validations that are important for their use case, setting the right severity level for each validation or modifying one of the standard profiles, turning on and off individual validations in that profile.</p><ul><li>Validations can be extended</li></ul><p>AMF validation profiles can be extended with custom validations defined by clients. A declarative approach using AMF validation profile dialect can be used to define new validations, or a programmatic mechanism based on JavaScript functions can be followed. Advanced users can always define standard SHACL constraints to have complete control over the validation mechanism.</p><ul><li>Validations are data</li></ul><p>AMF can parse the validation profile for an API and generate a model in the same way it parses the API definition itself. API model and validation profile model can be linked, stored, and queried as a single unified data graph.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="validation-using-data-shapes"></a>Validation using data shapes<a class="hash-link" href="#validation-using-data-shapes" title="Direct link to heading">#</a></h3><p>The main notion in AMF validation is that of a <code>data shape</code>.</p><p>The output of the AMF parser is a data graph where the nodes in the graph, and their relationships capture the information of the input RAML or OAS document.</p><p>Data shapes impose restrictions about the valid properties and relationships for the nodes in the parsed data graph, grouped by node type.</p><p>For example, the following extract from a RAML document located at <code>http://exchange.mulesoft.com/myorg/loans.raml</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Loans API</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.3</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Will produce the following data graph:</p><p><strong> insert graph </strong></p><p>As we can see in the image, the &#x27;title&#x27; RAML property has been parsed and mapped to the <a href="http://schema.org/name" target="_blank" rel="noopener noreferrer">schema-org &#x27;name&#x27; property</a> in the parsed model, and the &#x27;version&#x27; property has been mapped to the <a href="http://schema.org/version" target="_blank" rel="noopener noreferrer">schema-org &#x27;version&#x27; property</a>. At the same time, the main API document located at the root of the document <code>#/</code> has been marked as being an <a href="https://pending.schema.org/WebAPI" target="_blank" rel="noopener noreferrer">instance of schema-org WebAPI class</a>.</p><p>In order to consider the model encoded in this graph as valid, we might want to impose some restrictions for the nodes in the graph of type <code>schema:WebAPI</code>, for example, if certain properties are mandatory or optional, the range of the data type for the properties, etc.
In order to do this, we can define a &#x27;data shape&#x27; constraining all instances of the <code>schema:WebAPI</code> type. For example, we can make the version mandatory and impose a pattern for the version string. This can be achieved using AMF validation profile syntax in the following way:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">validations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  version</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">constraints</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Version</span><span class="token plain"> is mandatory and must be a semantic version </span><span class="token class-name">M</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">r</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    targetClass</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token class-name">WebAPI</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    propertyConstraints</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        minCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        pattern</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\d+\.\d+(\.\d+)?&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This snippet of text declares a new data shape (identified by &#x27;version-constraints&#x27;) for all instances of the <code>schema:WebAPI</code> class where for the <code>schema.version</code> property the minimum count of the property must be 1 (making it mandatory), and the value of the property must match the provided regular expression.</p><p>AMF validation will parse this data shape definition and validate that the model complies with all the data shapes defined. If some constraints are not met, a validation report including the node in the graph that violates the constraint, the identifier of the violated constraint and property, a descriptive message and information about the location in the input document of the model information violating the constraint will be generated.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="validation-profiles"></a>Validation Profiles<a class="hash-link" href="#validation-profiles" title="Direct link to heading">#</a></h3><p>In order to use data shapes in any realistic way, a number of data shapes must be defined and re-used together many times to provide a consistency in different RAML documents. We call these sets of related validations &#x27;validation profiles&#x27;. AMF allows customers to define validation profiles using a declarative validation syntax.</p><p>Additionally, profiles also support the notion of a severity level for each validation, ranging from <code>VIOLATION</code> to <code>INFO</code>, that can be attached to each specific data shape in the profile.</p><p>Profiles can extend other profiles, adding or re-defining validations, changing the severity level or disabling some base profile validations.</p><p>AMF includes by default 3 validation profiles: RAML, OpenAPI and AMF that follow respectively the constraints defined in the RAML 1.0 specification, OpenAPI 2.0 specification and the common set of validations across both specifications.</p><p>For example, the OpenAPI profile defines a validation to make the &#x27;schema:version&#x27; property mandatory (identified by amf-parser.mandatory-api-version), but the RAML profile doesn&#x27;t include this validation since it is not mandatory in RAML.</p><p>AMF clients can decide if they want to use the OpenAPI or RAML standard profile, create a custom profile inheriting from each of these but adapting some data shapes to their own needs or to create a new validation profile completely from scratch.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="validation-architecture"></a>Validation architecture<a class="hash-link" href="#validation-architecture" title="Direct link to heading">#</a></h3><p>This section describes the technical details of the AMF validation mechanism. If you are just interested in using the validation mechanism, and you are not interested into advanced use cases like using SHACL directly, this section can be safely skipped.</p><p>The following diagram shows the main components of the validation mechanism in AMF:</p><p><strong> insert graph </strong></p><p>Validation involves two model graphs:</p><ul><li>data graph</li></ul><p>Generated after parsing the input RAML/OAS document, containing all the information in the domain model, like the HTTP API</p><ul><li>shapes graph</li></ul><p>Generated after parsing a custom or standard validation profile and containing restrictions about the shape of the domain entities in the data graph. Shapes are expressed as SHACL shapes.</p><p>The following diagram shows the standard data shapes that can be expressed in SHACL:</p><p><strong> insert graph </strong></p><p>Additional shapes can be added to SHACL to define new types of validations. Additionally, SHACL also supports JavaScript constraints that can be defined inline as JavaScript code or collected into validation libraries.</p><p>Both the data graph and the shapes graph can be serialised using AMF as <a href="https://www.w3.org/TR/json-ld/" target="_blank" rel="noopener noreferrer">JSON-LD</a> documents containing all the information about the graph.</p><p>In order to trigger the validation, both graphs are passed to the standard SHACL 1.0 library that will compute the potential violations according to SHACL semantics and generate a validation report as an output data graph.
This report can be serialised as a JSON-LD document that can be processed by machines or as a human-friendly textual report.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="validation-profile-syntax"></a>Validation Profile syntax<a class="hash-link" href="#validation-profile-syntax" title="Direct link to heading">#</a></h2><p>Validation profile documents are defined as a <a href="https://github.com/mulesoft/amf/blob/master/vocabularies/dialects/validation.raml" target="_blank" rel="noopener noreferrer">RAML dialect extension</a> (see the documentation about RAML vocabulary and Dialect to know how to work with RAML extensions).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="header-and-dialect-document-type"></a>Header and dialect document type<a class="hash-link" href="#header-and-dialect-document-type" title="Direct link to heading">#</a></h3><p>The header identifying the Validation Profile dialect and the current 1.0 version is:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%Validation Profile 1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This header is mandatory in all validation profile documents.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="profile-node"></a>Profile node<a class="hash-link" href="#profile-node" title="Direct link to heading">#</a></h3><p>The main node in a Validation Profile document is the Profile node.</p><p>These are the possible properties in the node:</p><table><thead><tr><th>property</th><th>description</th><th>range</th><th>allow multiple values</th><th>is map</th></tr></thead><tbody><tr><td>profile</td><td>Name for the custom profile</td><td>string</td><td>false</td><td>false</td></tr><tr><td>prefixes</td><td>Map of prefixes used to build identifiers in validation of dialects</td><td>(String,String)</td><td>true</td><td>true</td></tr><tr><td>description?</td><td>Human readable description of the profile</td><td>string</td><td>false</td><td>false</td></tr><tr><td>extends?</td><td>Base profile this profile is extending</td><td>string: RAML, OpenAPI, AMF</td><td>false</td><td>false</td></tr><tr><td>violation?</td><td>List of validations identifiers that will have VIOLATION severity</td><td>string</td><td>true</td><td>true</td></tr><tr><td>warning?</td><td>List of validations identifiers that will have WARNING severity</td><td>string</td><td>true</td><td>false</td></tr><tr><td>info?</td><td>List of validations identifiers that will have INFO severity</td><td>string</td><td>true</td><td>false</td></tr><tr><td>disabled?</td><td>List of validations from the extended profile that will be disabled</td><td>string</td><td>true</td><td>false</td></tr><tr><td>validations?</td><td>List of custom data shapes defining validations in this profile</td><td>ShapeValidation node or FunctionValidation node</td><td>-</td><td>true</td></tr></tbody></table><p>In order to change the severity level or disable a validation, the identifier of the validation must be added to the right section of the document.
Refer to the list of standard validations defined for each profile to find which validations can be modified.</p><p>The following example defines a new profile named <code>Custom</code> extending the RAML standard profile and disabling the <code>amf-parser.raml-status-code</code> validation including in that profile.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%Validation Profile 1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Custom</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">extends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RAML</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">disabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> amf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">parser.raml</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">code</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Also, note that declaring a validation to the map of <code>validations</code> does not automatically enable it. Custom validation must still be added to the section with the right severity level for them to be effective.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="identifying-classes-and-properties"></a>Identifying classes and properties<a class="hash-link" href="#identifying-classes-and-properties" title="Direct link to heading">#</a></h3><p>AMF Validation support identifiers for the standard domain elements generated by the AMF parser for RAML and OpenAPI.
If you want to other classes and properties, for example when working with dialects, the URI of the element or register a prefix to use CURIEs:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%Validation Profile 1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Custom Profile for My Vocabulary</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">prefixes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">myvocab</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//myorg.com/vocabularies/myvocab</span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now we could identify target classes and properties using CURIEs like <code>myvocab.MyClass</code> or <code>myvocab.MyProperty</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="shapevalidation-node"></a>ShapeValidation node<a class="hash-link" href="#shapevalidation-node" title="Direct link to heading">#</a></h3><p>Custom data shapes can be defined declaratively as <code>ShapeValidation</code> nodes that can be added to the <code>validations</code> property in the profile document.</p><p>These are the properties of a shape validation:</p><table><thead><tr><th>property</th><th>description</th><th>range</th><th>allow multiple values</th><th>is map</th></tr></thead><tbody><tr><td>message?</td><td>Error message that will be returned in case of a violation</td><td>string</td><td>false</td><td>false</td></tr><tr><td>targetClass</td><td>Identifier of the class in the AMF parsed model the data shape will be validating. It must be a valid class identifier in the model</td><td>string</td><td>false</td><td>false</td></tr><tr><td>propertyConstraints</td><td>map of property constraints for the data shape</td><td>PropertyConstraint node</td><td>-</td><td>true</td></tr></tbody></table><p>Each data shape can contain one or more constraints over properties for the class defined in a property constraint node.</p><p>The following example introduces a shape validation redefining the valid values for the status code of a response:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%Validation Profile 1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Custom</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">extends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RAML</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">disabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> amf</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">parser.raml</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">code</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">violation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">code</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">my-status-code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Invalid status code value</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http.statusCode</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">propertyConstraint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hydra.statusCode</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hydra.statusCode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^(ok</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">failure</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">exception)$</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>After adding this constraint and disabling the standard RAML status code validation, the following fragment from RAML document will be valid:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">/endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">get</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">responses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ok</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">exception</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="propertyconstraint-node"></a>PropertyConstraint node<a class="hash-link" href="#propertyconstraint-node" title="Direct link to heading">#</a></h3><p>Each property constraint node is built as a map with keys targeting properties in the AMF parsed model and the constraints for that property in the model.</p><p>The following table defines the constraints that can be used to define the shape of the property in the model:</p><table><thead><tr><th>property</th><th>description</th><th>range</th><th>allow multiple values</th><th>is map</th></tr></thead><tbody><tr><td>pattern?</td><td>Regular expression</td><td>string</td><td>false</td><td>false</td></tr><tr><td>minLength?</td><td>Minimum length of a string</td><td>integer</td><td>false</td><td>false</td></tr><tr><td>maxLength?</td><td>Maximum length of a string</td><td>integer</td><td>false</td><td>false</td></tr><tr><td>maxCount?</td><td>Maximum cardinality for the parsed property</td><td>integer</td><td>false</td><td>false</td></tr><tr><td>minCount?</td><td>Minimum cardinality for the parsed property</td><td>integer</td><td>false</td><td>false</td></tr><tr><td>minExclusive?</td><td>Minimum exclusive value for the parsed property</td><td>number</td><td>false</td><td>false</td></tr><tr><td>maxExclusive?</td><td>Maximum exclusive value for the parsed property</td><td>number</td><td>false</td><td>false</td></tr><tr><td>minInclusive?</td><td>Minimum inclusive value for the parsed property</td><td>number</td><td>false</td><td>false</td></tr><tr><td>maxInclusive?</td><td>Maximum inclusive value for the parsed property</td><td>number</td><td>false</td><td>false</td></tr><tr><td>in?</td><td>Enumeration of values allowed for the property</td><td>any</td><td>true</td><td>false</td></tr><tr><td>range?</td><td>Literal range of a property from string, integer, float, anyUri, boolean</td><td>false</td><td>false</td><td></td></tr></tbody></table><p>A single property constraint can have more than one constraint in the map of constraints.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="functionvalidation-node"></a>FunctionValidation node<a class="hash-link" href="#functionvalidation-node" title="Direct link to heading">#</a></h3><p>Alternatively, validations can be defined programmatically using JavaScript functions.</p><p>FunctionConstraint nodes are added to the <code>validations</code> property by the name of the function constraint and can have the following properties:</p><table><thead><tr><th>property</th><th>description</th><th>range</th><th>allow multiple values</th><th>is map</th></tr></thead><tbody><tr><td>message?</td><td>Error message that will be returned in case of a violation</td><td>string</td><td>false</td><td>false</td></tr><tr><td>targetClass</td><td>Identifier of the class in the AMF parsed model the data shape will be validating. It must be a valid class identifier in the model</td><td>string</td><td>false</td><td>false</td></tr><tr><td>code?</td><td>JavaScript function that will be invoked to check if a violation has happened for the instance of the target class passed as an argument</td><td>string</td><td>false</td><td>false</td></tr><tr><td>libraries?</td><td>URLs pointing to JavaScript files including function definitions that will can be used in the validation</td><td>string</td><td>true</td><td>false</td></tr><tr><td>functionName?</td><td>Name of a function in one of the libraries that will be used to check if a violation has happened for the instance of the target class passed as an argument</td><td>string</td><td>false</td><td>false</td></tr></tbody></table><p>Validation functions must be coded as anonymous functions accepting as single input the node in the model encoded as JSON-LD in expanded form  that is an instance of <code>targetClass</code>.
Validation functions must return <code>true</code> if no constraint violation is found or <code>false</code> to signal a validation error.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="js-validation-api"></a>JS Validation API<a class="hash-link" href="#js-validation-api" title="Direct link to heading">#</a></h4><p>AMF validation provides a minimal interface to help build the validation functions:</p><p>In order to traverse the model, prefixes for all the namespaces in the model have been defined:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-json codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;raml-shapes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;http://raml.org/vocabularies/shapes#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;shacl&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;http://www.w3.org/ns/shacl#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;amf-parser&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://raml.org/vocabularies/amf/parser#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;rdfs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">       </span><span class="token string" style="color:#e3116c">&quot;http://www.w3.org/2000/01/rdf-schema#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;doc&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;http://raml.org/vocabularies/document#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">       </span><span class="token string" style="color:#e3116c">&quot;http://raml.org/vocabularies/data#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;owl&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;http://www.w3.org/2002/07/owl#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;meta&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">       </span><span class="token string" style="color:#e3116c">&quot;http://raml.org/vocabularies/meta#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sourcemaps&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://raml.org/vocabularies/document-source-maps#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;rdf&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;xsd&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;http://www.w3.org/2001/XMLSchema#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;schema&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">     </span><span class="token string" style="color:#e3116c">&quot;http://schema.org/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;http&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">       </span><span class="token string" style="color:#e3116c">&quot;http://raml.org/vocabularies/http#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sh&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;http://www.w3.org/ns/shacl#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;hydra&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;http://www.w3.org/ns/hydra/core#&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This means that validation code can use <a href="http://www.w3.org/TR/curie" target="_blank" rel="noopener noreferrer">CURIEs</a> to traverse the model JSON-LD structure instead of full URIs</p><p>For example the following validation targets the requests in the endpoints. In the validation function to get to the headers, we can just use <code>http:header</code> instead of the full URI <code>http://raml.org/vocabularies/http#header</code>:
Notice that since we are working with the JSON-LD graph in expanded form, the value of a property will always be an array, even if the property has a single value.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test-validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> All requests should have headers</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http.Request</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">functionConstraint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        function(request) {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          var headers = request[http:header];</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          return headers.length &gt; 0;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        }</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Sometimes we need to traverse the model from the root node using a chain of properties. the <code>path</code> function can be used for this. It accepts a sequence of properties and will try to follow the path returning all the accumulated values found for the path.
Paths are expressed as sequences of CURIEs joined by the <code>/</code> separator.</p><p>For example, imagine we need to modify the previous validation to check that a particular header with a name is present in all the requests. In order to do this, we need to traverse from the http:Request to the header (http:header) and from there to the name of each header (schema:header) and check if the name of the property is present. Instead of nesting loops, we could use the <code>path</code> property for this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test-validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Header x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">token is mandatory in all requests</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http.Request</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">functionConstraint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        function(request) {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          var pathChain = &#x27;http:header / schema:name&#x27;;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          var headerNames = path(request, pathChain);</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          for (var i=0; i&lt;headerNames.length; i++) {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            if (headerNames[i] === &quot;x-token&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              return true;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          }</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        }</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Validation functions should be stateless, since each validation function is executed independently. However, for certain checks we need to keep state through invocations. In order to accomplish this the validation engine offers a global <code>accumulators</code> hash persistent between validation function invocations. Validation functions can use this hash to keep state in order to compute certain restrictions.</p><p>For example, let&#x27;s imagine we need to create a validation checking that the name of the endpoints (resources in RAML, path items in OpenAPI) are unique. For that we can use the <code>accumulators</code> hash to store the names of the endpoints and find duplicated values:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">unique-identifiers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Resource names must be unique</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http.EndPoint</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">functionConstraint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        function(resource) {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          var name = (resource[&#x27;schema:name&#x27;] || [])[0];</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          if(accumulators[name] == null) {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            accumulators[name] = true;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            return true;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          } else {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            return false;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          }</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        }</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="modular-validation-profiles-libraries"></a>Modular Validation Profiles: Libraries<a class="hash-link" href="#modular-validation-profiles-libraries" title="Direct link to heading">#</a></h3><p>Validation profiles are RAML documents, as such the Validation Profile dialect defines how to split the description into a profile in libraries of data shapes that can be re-used in multiple profiles.</p><p>To declare a validation data shapes library, the following header must be used:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%Library / Validation Profile 1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In the library validations can be declared using the <code>shapes</code> for the ShapeValidation nodes and <code>functions</code> for the FunctionValidation nodes.</p><p>After being declared, validation libraries can be used in a validation profile document using the <code>uses</code> RAML property and providing an alias for the library
Notice that a name for the data shape or function constraint connected to the <code>validations</code> property  will still be required to be able to use the data shape.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="modular-validation-profiles-typed-fragments"></a>Modular Validation Profiles: Typed fragments<a class="hash-link" href="#modular-validation-profiles-typed-fragments" title="Direct link to heading">#</a></h3><p>In the shame way, data shapes and function constraints can be defined as valid fragments for the Validation Profile dialect and included in a Validation Profile document.</p><p>The required headers for the fragments are the following:</p><table><thead><tr><th>Fragment header</th><th>Node type</th></tr></thead><tbody><tr><td>#%ShapeValidation / Validation Profile 1.0</td><td>ShapeValidation node</td></tr><tr><td>#%FunctionValidation / Validation Profile 1.0</td><td>FunctionValidation node</td></tr></tbody></table></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-02-18T15:24:38.000Z" class="docLastUpdatedAt_1Qna">2/18/2021</time> by <strong>arielmirra</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#validation-approach" class="table-of-contents__link">Validation approach</a><ul><li><a href="#validation-using-data-shapes" class="table-of-contents__link">Validation using data shapes</a></li><li><a href="#validation-profiles" class="table-of-contents__link">Validation Profiles</a></li><li><a href="#validation-architecture" class="table-of-contents__link">Validation architecture</a></li></ul></li><li><a href="#validation-profile-syntax" class="table-of-contents__link">Validation Profile syntax</a><ul><li><a href="#header-and-dialect-document-type" class="table-of-contents__link">Header and dialect document type</a></li><li><a href="#profile-node" class="table-of-contents__link">Profile node</a></li><li><a href="#identifying-classes-and-properties" class="table-of-contents__link">Identifying classes and properties</a></li><li><a href="#shapevalidation-node" class="table-of-contents__link">ShapeValidation node</a></li><li><a href="#propertyconstraint-node" class="table-of-contents__link">PropertyConstraint node</a></li><li><a href="#functionvalidation-node" class="table-of-contents__link">FunctionValidation node</a></li><li><a href="#modular-validation-profiles-libraries" class="table-of-contents__link">Modular Validation Profiles: Libraries</a></li><li><a href="#modular-validation-profiles-typed-fragments" class="table-of-contents__link">Modular Validation Profiles: Typed fragments</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/AML/aml">Get Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/aml-org/amf-aml" target="_blank" rel="noopener noreferrer" class="footer__link-item">AML</a></li><li class="footer__item"><a href="https://github.com/aml-org/aml-spec" target="_blank" rel="noopener noreferrer" class="footer__link-item">AML Spec</a></li><li class="footer__item"><a href="https://github.com/aml-org/amf" target="_blank" rel="noopener noreferrer" class="footer__link-item">AMF</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" src="/img/logos/amlLogo.svg"></div><div class="footer__copyright">Copyright Â© 2021 Mulesoft, LLC, a Salesforce company</div></div></div></footer></div>
<script src="/styles.3e225d29.js"></script>
<script src="/runtime~main.ec3c9e33.js"></script>
<script src="/main.fc69e7f1.js"></script>
<script src="/1.bb102a6f.js"></script>
<script src="/2.461c41ab.js"></script>
<script src="/1be78505.51367d36.js"></script>
<script src="/935f2afb.17b72296.js"></script>
<script src="/39.10c467ad.js"></script>
<script src="/d4d33273.f5fec0e6.js"></script>
</body>
</html>